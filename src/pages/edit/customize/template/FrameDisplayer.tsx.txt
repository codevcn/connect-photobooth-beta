import { TPrintTemplate } from '@/utils/types/global'
import { TemplateFrame } from './TemplateFrame'
import type React from 'react'
import { cn } from '@/configs/ui/tailwind-utils'
import {
  styleFrameByTemplateType,
  styleToFramesDisplayerByTemplateType,
} from '@/configs/print-template/templates-helpers'
import { useEffect } from 'react'

type TFramesDisplayerProps = {
  template: TPrintTemplate
} & Partial<{
  plusIconReplacer?: React.JSX.Element
  frameStyles: Partial<{
    container: React.CSSProperties
    plusIconWrapper: React.CSSProperties
  }>
  frameClassNames: Partial<{
    container: string
    plusIconWrapper: string
  }>
  displayerClassNames: {
    container: string
  }
  onClickFrame: (e: React.MouseEvent<HTMLDivElement, MouseEvent>, frameId: string) => void
}>

export const FramesDisplayer = ({
  template,
  plusIconReplacer,
  frameStyles,
  frameClassNames,
  displayerClassNames,
  onClickFrame,
}: TFramesDisplayerProps) => {
  const { frames, type } = template

  useEffect(() => {
    const framesImageInteraction = document.querySelector<HTMLElement>(
      '.NAME-frames-image-interaction'
    )
    if (framesImageInteraction) {
      framesImageInteraction.style.height = 'auto'
    }
  }, [])

  return (
    <div className="NAME-frames-displayer max-h-full max-w-full">
      <div
        className={cn(
          'NAME-frames-add-image-displayer bg-gray-600/30 p-0.5 max-h-full max-w-full absolute top-0 left-0 z-10',
          displayerClassNames?.container
        )}
        style={{ ...styleToFramesDisplayerByTemplateType(type) }}
      >
        {frames.map((frame) => (
          <div
            key={frame.id}
            style={{
              ...frameStyles?.container,
              ...styleFrameByTemplateType(type, frame.index),
            }}
            className={cn(
              'NAME-template-frame flex justify-center items-center overflow-hidden h-full w-full border border-gray-600 border-dashed',
              frameClassNames?.container
            )}
            onClick={onClickFrame ? (e) => onClickFrame(e, frame.id) : undefined}
          >
            {plusIconReplacer || (
              <div
                style={frameStyles?.plusIconWrapper}
                className={cn(
                  'NAME-plus-icon-wrapper flex items-center justify-center text-white h-full w-full bg-gray-400/90',
                  frameClassNames?.plusIconWrapper
                )}
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  strokeWidth="2"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  className="lucide lucide-plus-icon lucide-plus"
                >
                  <path d="M5 12h14" />
                  <path d="M12 5v14" />
                </svg>
              </div>
            )}
          </div>
        ))}
      </div>
      <div
        className={cn(
          'NAME-frames-image-interaction p-0.5 max-h-full max-w-full absolute top-0 left-0 z-20',
          displayerClassNames?.container
        )}
        style={{ ...styleToFramesDisplayerByTemplateType(type) }}
      >
        {frames.map((frame) => (
          <TemplateFrame
            key={frame.id}
            templateFrame={frame}
            templateType={type}
            plusIconReplacer={plusIconReplacer}
            styles={frameStyles}
            classNames={frameClassNames}
            onClickFrame={onClickFrame}
            displayPlusIcon={false}
          />
        ))}
      </div>
    </div>
  )
}
